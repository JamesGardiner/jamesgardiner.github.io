<!DOCTYPE html>
<html lang="en-us">
	
  <!-- google_analytic file -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61555722-1', 'auto');
  ga('send', 'pageview');

</script>
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  

  

  <!-- CSS -->
  

  
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/custom.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Ubuntu:400,400italic,700">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <title>
    
      Connecting to Postrges with Pandas and Jupyter
      James Gardiner
    
  </title>
</head>


  <body class="sidebar-overlay">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  
  <div class="sidebar-logo">
    <img src="http://www.gravatar.com/avatar/64efb4611c5f7a0f48d81a92c61e64e4?s=120" />
  </div>

  <div id="contact-list" style="text-align:center">
    
      <a href="https://github.com/jamesGardiner">
        <span class="fa-stack fa-lg">
          <i class="fa fa-square-o fa-stack-2x"></i>
          <i class="fa fa-github-alt fa-stack-1x"></i>
        </span>
      </a>
    
  
      <a href="https://twitter.com/_JamesRG">
        <span class="fa-stack fa-lg">
          <i class="fa fa-square-o fa-stack-2x"></i>
          <i class="fa fa-twitter fa-stack-1x"></i>
        </span>
      </a>
    

    
      <a href="https://linkedin.com/in/jrgardiner">
        <span class="fa-stack fa-lg">
          <i class="fa fa-square-o fa-stack-2x"></i>
          <i class="fa fa-linkedin fa-stack-1x"></i>
        </span>
      </a>
    
  </div>

  <div class="sidebar-item">
    <p>A site for my analyses, findings, musings and other helpful stuff.</p>
  </div>
  
  <ul>
    
    <li><a href="/blog/read_sql_pandas">Connecting to Postrges with Pandas and Jupyter</a></li>
    
    <li><a href="/blog/fitbit-data-analysis">Fitbit Data Analysis</a></li>
    
    <li><a href="/blog/police_data_api_in_leaflet_part2">Using the data.police.uk API with Leaflet - part 2</a></li>
    
    <li><a href="/blog/police_data_api_in_leaflet_part1">Using the data.police.uk API with Leaflet</a></li>
    
    <li><a href="/blog/a-basic-leaflet-map-in-jekyll">A basic Leaflet.js map in Jekyll</a></li>
    
  </ul>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    
	
    
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About me</a>
        
      
    
    <!--<a class="sidebar-nav-item" href="/archive/v1.0.0.zip">Download</a>
    <a class="sidebar-nav-item" href="">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.0.0</span>-->
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2016. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">James Gardiner</a>
            <br />
            <small>A blog for all things data</small>
          </h3>
        </div>
      </div>
      <div class="container content">
	    <div class="post">
  <h1 class="post-title">Connecting to Postrges with Pandas and Jupyter</h1>
  <span class="post-date">18 Apr 2016</span>
  <p>One of my main activities at the moment is the collection and storage of web data from a number of sources, which is being stored in an AWS RDS PostgreSQL server. Unfortunately, none of the team I’m working with have used PostgreSQL before, certainly not through an AWS instance and definitely not through a Jupyter notebook and Pandas, though they do have a fair bit of experience using Pandas/R for centralized data analysis using flat file, such as CSVs.</p>

<hr />
<!--more-->

<p>To show them how to do this, I put together a quick notebook showing how easy it is to do, and thought it would port over well to a short blog post.</p>

<h3 id="config-files">Config Files</h3>
<p>First thing to do is setup a config file. This allows you to keep information you don’t want to share private, but means you don’t have to constantly enter passwords, usernames, host URLs and other such tedious details!</p>

<p>There’s a few ways to do this type of thing (including using environment variables), but my preference here is to save a JSON formatted config.json file in the same directory that the notebook server is started in. I use the following format:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="w">    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"database"</span><span class="p">:</span><span class="w"> </span><span class="s2">"db_name"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"schema"</span><span class="p">:</span><span class="w"> </span><span class="s2">"schema_name"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user_name"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"host_url"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="s2">"port_num"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"passw"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user_password"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Obviously the values need to be changed to match your own. This can be read by using:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">json</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'config.json'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre>
</div>

<p>which returns a python dict object with the keys specified in the JSON document. We can use these to construct a connection string to use with psycopg2:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">conn_str</span> <span class="o">=</span> <span class="s">"host={} dbname={} user={} password={}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">passw</span><span class="p">)</span>
</code></pre>
</div>

<p>which is then passed to the psycopg2.connect method as the only parameter:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">conn_str</span><span class="p">)</span>
</code></pre>
</div>

<p>To read this in to Pandas as a dataframe is simple (swap <code class="highlighter-rouge">table_name</code> for the relevant table:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s">'select * from table_name'</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
</code></pre>
</div>

<p>If the table is large, Pandas offers the ability to iterate over the database by specifying the <code class="highlighter-rouge">chunksize</code> keyword argument, where <code class="highlighter-rouge">chunksize</code> is the number of rows to include in each chunk. The example below iterates over a table 5000 rows at time, and can squeeze some bigger databases into a dataframe:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s">'select * from table_name'</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">conn</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">5000</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</code></pre>
</div>

<p>Obviously, if the database is too large even when represented in memory, then you will have to try another approach, such as implementing a workflow using specific tools such as <a href="http://blaze.pydata.org/pages/overview/">Blaze</a>.</p>


</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/blog/fitbit-data-analysis">
            Fitbit Data Analysis
            <small>03 Apr 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/police_data_api_in_leaflet_part2">
            Using the data.police.uk API with Leaflet - part 2
            <small>05 May 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/police_data_api_in_leaflet_part1">
            Using the data.police.uk API with Leaflet
            <small>05 May 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

	    <a href="https://twitter.com/share" class="twitter-share-button" data-via="<_JamesRG>">Tweet</a>

<!-- Put this just before the closing body tag -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
	    <!-- disquss file -->

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'jamesgardiner'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <div class="footer">
          <p>
          &copy; James Gardiner 2016. All rights reserved.
          </p>
        </div>
      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
	
    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
